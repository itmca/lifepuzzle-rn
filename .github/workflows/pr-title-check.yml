name: PR Title Check

on:
  pull_request:
    types: [opened, edited, synchronize, reopened, ready_for_review]

jobs:
  check-pr-title:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR title
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.pull_request.title;

            // Chris Beams 스타일: 명령형, 첫 글자 대문자, 50자 이내, 마침표 없음
            const regex = /^(\[(SHIP|SHOW|ASK)\])?(\[LP-\d+\])?\s*[A-Z][^.]*$/;

            if (!regex.test(title) || title.length > 50) {
              const errorMessage = `❌ PR 제목 형식이 올바르지 않습니다: "${title}"`;

              console.log(errorMessage);
              console.log(`
                Chris Beams 스타일 규칙:
                  - 명령형으로 작성 (Add, Fix, Update 등)
                  - 첫 글자 대문자
                  - 50자 이내
                  - 마침표 없음

                올바른 예시:
                  - Add user authentication feature
                  - [SHOW] Fix login button UI issue
                  - [SHIP][LP-1234] Update photo upload logic
                  - [LP-5678] Refactor gallery component
              `);

              core.setFailed(errorMessage);
            } else {
              console.log("✅ PR 제목 통과");
            }
